{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="{% static 'css/perfil.css' %}">

    <link rel="icon" type="image/png" href="{% static 'img/icon.png' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
  <div class="container">
    <div class="header">

      <div class="profile-section">
        <div class="profile-container">
            <label for="profile-pic" class="profile-pic-label">
                <img src="{% static 'img/perfil.png' %}" alt="Profile" id="profile-img" class="profile-pic">
            </label>
        </div>

        <!-- Botones para subir y eliminar foto -->
        <div class="profile-actions">
            <button onclick="document.getElementById('profile-pic').click();" style="margin-right: 10px; border-radius: 50px;">Subir foto</button>

            <button style=" border-radius: 50px;"  onclick="confirmRemovePhoto()">Eliminar foto</button>
        </div>

        <!-- Input oculto para seleccionar archivo -->
        <input type="file" id="profile-pic" accept="image/*" style="display:none;" onchange="loadFile(event)">

        <!-- Menú de opciones -->
        <div id="profile-menu" class="profile-menu" style="display: none;">
            <button onclick="triggerFileInput()">Subir foto</button>
            <button onclick="removePhoto()">Eliminar foto</button>
        </div>

        <p class="brand-name">Aleja_23</p>
      </div>

      <div class="input">
        <button class="value" id="perfil">
          <i class="fa-solid fa-circle-user"></i>
          Mi perfil
        </button>

        <button class="value">
          <i class="fa-solid fa-rotate-left"></i>
          Mis Devoluciones
        </button>

        <button class="value">
          <i class="fa-solid fa-trash"></i>
          Eliminar Cuenta
        </button>

        <a href="{% url 'Ladingpage' %}" class="value" style="text-decoration:none;">
          <i class="fa-solid fa-right-from-bracket"></i>
          Salir
        </a>
      </div>
    </div>

    <div class="form-container">
        <form action="#">
            <div class="sector1">
                <label for="primerNombre">Primer Nombre:</label>
                <input type="text" id="primerNombre" name="primerNombre" required style="border-radius: 10px;">

                <label style="margin-top: 5px" for="primerApellido">Primer Apellido:</label>
                <input type="text" id="primerApellido" name="primerApellido" required style="border-radius: 10px;">
            </div>

            <div class="sector2">
                <label for="segundoNombre">Segundo Nombre:</label>
                <input type="text" id="segundoNombre" name="segundoNombre" style="border-radius: 10px;">

                <label style="margin-top: 5px" for="segundoApellido">Segundo Apellido:</label>
                <input type="text" id="segundoApellido" name="segundoApellido" style="border-radius: 10px;">
            </div>

            <div class="sector3">
                <label for="contrasena">Contraseña:</label>
                <input class="contrasena" type="password" id="contrasena" name="contrasena" required style="border-radius: 10px;">
            </div>

            <div class="sector4">
                <label for="nombreUsuario">Nombre de usuario:</label>
                <input type="text" id="nombreUsuario" name="nombreUsuario" required style="border-radius: 10px;">
            </div>

            <button style="margin-top: 30px; border-radius: 10px;" type="submit">Modificar</button>
            <button style="margin-top: 30px; border-radius: 10px;" type="submit">Guardar</button>
        </form>
    </div>
  </div>

<script>
    function loadFile(event) {
        var profileImg = document.getElementById('profile-img');
        var file = event.target.files[0];
        var reader = new FileReader();

        reader.onload = function(e) {
            profileImg.src = e.target.result;
            localStorage.setItem('profileImage', e.target.result); // Guarda la imagen en localStorage
        }

        if (file) {
            reader.readAsDataURL(file); // Lee el archivo como Data URL
        }
    }

    function removePhoto() {
        var profileImg = document.getElementById('profile-img');
        profileImg.src = "{% static 'img/perfil.png' %}"; // Cambia a la imagen predeterminada
        localStorage.removeItem('profileImage'); // Elimina la imagen guardada en localStorage
    }

    // Al cargar la página, revisa si ya hay una imagen guardada en localStorage y activa el botón "Mi perfil"
    window.onload = function() {
        // Cargar la imagen del perfil desde localStorage (si existe)
        var savedImage = localStorage.getItem('profileImage');
        if (savedImage) {
            document.getElementById('profile-img').src = savedImage;
        }

        // Resaltar automáticamente "Mi perfil" al cargar la página
        const miPerfil = document.getElementById('perfil');
        miPerfil.classList.add('active');

        // Escuchar eventos de clic en los botones del menú
        const buttons = document.querySelectorAll('.value');
        buttons.forEach(button => {
            button.addEventListener('click', function() {
                // Quitar la clase 'active' de todos los botones
                buttons.forEach(btn => btn.classList.remove('active'));

                // Añadir la clase 'active' solo al botón clicado
                this.classList.add('active');
            });
        });
    };

    function confirmRemovePhoto() {
        // Mostrar alerta de confirmación
        const userConfirmed = confirm("¿Estás seguro de que quieres eliminar tu foto de perfil?");
        
        if (userConfirmed) {
            // Si el usuario confirma, eliminar la foto
            removePhoto();
        } else {
            // Si el usuario cancela, no hacer nada
            console.log("Eliminación cancelada");
        }
    }

    function removePhoto() {
        var profileImg = document.getElementById('profile-img');
        profileImg.src = "{% static 'img/perfil.png' %}"; // Cambia a la imagen predeterminada
        localStorage.removeItem('profileImage'); // Elimina la imagen guardada en localStorage
    }
</script>
</body>
</html>
